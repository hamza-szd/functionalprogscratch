{"ast":null,"code":"import\"./editor.css\";import{useEffect,useRef,useState}from\"react\";import{Renderer}from\"./trees/render\";import{nodeAtIndexPath,isAncestor,rootIndexPath,parentIndexPath}from\"./trees/tree\";import{DndContext,DragOverlay,useSensor,useSensors}from\"@dnd-kit/core\";import Library from\"./library/Library\";import CodeEditorModal from\"./CodeEditorModal\";import{Parser}from\"../expr/parse\";import{ActiveDragContext,OnContextMenuContext,RenderCounterContext,RerenderContext}from\"./editor-contexts\";import{InitialEnvironment,mergeEnvs}from\"./library/environments\";import{CustomKeyboardSensor,CustomPointerSensor}from\"./blocks/drag-sensors\";import Split from\"react-split\";import{Typechecker}from\"../typechecker/typecheck\";import ValueEditorModal from\"./ValueEditorModal\";import{OutputArea}from\"./OutputArea\";import Nav from\"react-bootstrap/Nav\";import Tab from\"react-bootstrap/Tab\";import{groupBy,keyBy}from\"lodash\";import Tippy from\"@tippyjs/react\";import{ContextMenuTrigger}from\"rctx-contextmenu\";import{Program}from\"../simulator/program\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";function sortCollisionsClosestToZero(_ref,_ref2){let{data:{value:a}}=_ref;let{data:{value:b}}=_ref2;return Math.abs(a)-Math.abs(b);}function midY(rect){return(rect.top+rect.bottom)/2;}const collisionDetection=_ref3=>{let{collisionRect,droppableRects,droppableContainers}=_ref3;const collisions=[];for(const droppableContainer of droppableContainers){const{id}=droppableContainer;const rect=droppableRects.get(id);if(!(rect&&(id===\"library\"||Math.abs(midY(rect)-midY(collisionRect))<=Math.max(rect.height/2,collisionRect.height/2))&&rect.right>=collisionRect.left)){continue;}const intersectionStrength=collisionRect.left-rect.left+(id===\"library\"?20:0);if(intersectionStrength>0){collisions.push({id,data:{droppableContainer,value:id===\"library\"?0:intersectionStrength}});}}return collisions.sort(sortCollisionsClosestToZero);};let isAltPressed=false;export default function EditorComponent(_ref4){var _meta$pages;let{editor,onBlockContextMenu,codeEditorSubject,setCodeEditorSubject,renderCounter}=_ref4;const{trees,rerender}=editor;const{meta}=trees;const typechecker=new Typechecker();typechecker.addDefines(trees.list());const[valueEditorSubject,setValueEditorSubject]=useState();useEffect(()=>{const handleDocumentMouseDown=event=>{isAltPressed=event.altKey;};document.addEventListener(\"mousedown\",handleDocumentMouseDown);return()=>{document.removeEventListener(\"mousedown\",handleDocumentMouseDown);};},[]);const[weakRenderCounter,setWeakRenderCounter]=useState(0);function weakRerender(){setWeakRenderCounter(weakRenderCounter+1);}const[activeDrag,setActiveDrag]=useState();const[activeDragOver,setActiveDragOver]=useState();const blocksArea=useRef(null);function provideEditorContext(body){return/*#__PURE__*/_jsx(OnContextMenuContext.Provider,{value:onBlockContextMenu,children:/*#__PURE__*/_jsx(ActiveDragContext.Provider,{value:activeDrag,children:/*#__PURE__*/_jsx(RerenderContext.Provider,{value:weakRerender,children:/*#__PURE__*/_jsx(RenderCounterContext.Provider,{value:renderCounter,children:body})})})});}const[activePageID,setActivePageID]=useState();useEffect(()=>{meta.currentPageID=activePageID;},[activePageID]);const pagesByID=keyBy((_meta$pages=meta.pages)!==null&&_meta$pages!==void 0?_meta$pages:[],_ref5=>{let{id}=_ref5;return id;});const treesByPageID=groupBy(trees.list(),_ref6=>{let{page}=_ref6;return page;});const pageIDs=[...new Set([...Object.keys(pagesByID),...Object.keys(treesByPageID)].map(Number)).values()].sort();useEffect(()=>{const candidate=meta.currentPageID!==undefined&&pageIDs.includes(meta.currentPageID)?meta.currentPageID:pageIDs.at(-1);if(candidate!==undefined||activePageID!==undefined){setActivePageID(candidate);}},[meta]);const environment=mergeEnvs(InitialEnvironment,new Program(trees.list()).defines.environment());return/*#__PURE__*/_jsxs(DndContext,{autoScroll:false,sensors:useSensors(useSensor(CustomPointerSensor,{activationConstraint:{distance:4}}),useSensor(CustomKeyboardSensor)),collisionDetection:collisionDetection,onDragStart:onBlockDragStart,onDragOver:onBlockDragOver,onDragEnd:onBlockDragEnd,children:[provideEditorContext(/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CodeEditorModal,{indexPath:codeEditorSubject,onClose:onCodeEditorClose}),/*#__PURE__*/_jsx(ValueEditorModal,{indexPath:valueEditorSubject,onClose:onValueEditorClose}),/*#__PURE__*/_jsx(DragOverlay,{dropAnimation:null,zIndex:99999999,className:\"drag-overlay\",children:activeDrag&&new Renderer(environment,typechecker,editor,{forDragOverlay:activeDragOver!==null&&activeDragOver!==void 0?activeDragOver:true}).render(activeDrag.indexPath)})]})),/*#__PURE__*/_jsxs(Split,{className:\"editor-split split\",direction:\"horizontal\",cursor:\"col-resize\",sizes:[78,22],minSize:[0,0],snapOffset:120,gutterSize:12,gutterAlign:\"center\",children:[/*#__PURE__*/_jsxs(Split,{className:\"canvas-split split\",direction:\"vertical\",cursor:\"row-resize\",sizes:[40,60],minSize:[0],snapOffset:120,gutterSize:12,gutterAlign:\"center\",children:[/*#__PURE__*/_jsx(OutputArea,{}),/*#__PURE__*/_jsx(\"div\",{className:\"blocks\",children:/*#__PURE__*/_jsxs(Tab.Container,{activeKey:activePageID,children:[/*#__PURE__*/_jsx(Tab.Content,{className:\"blocks-page-tabcontent\",children:/*#__PURE__*/_jsx(ContextMenuTrigger,{id:\"editor-background-menu\",children:pageIDs.map(pageID=>{var _treesByPageID$pageID;return/*#__PURE__*/_jsx(Tab.Pane,{eventKey:pageID,className:\"blocks-page\",ref:blocksArea,transition:false,unmountOnExit:true,children:provideEditorContext(/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{width:Math.max(...trees.list().map(tree=>tree.location.x))+document.documentElement.clientWidth/2,height:Math.max(...trees.list().map(tree=>tree.location.y))+document.documentElement.clientHeight/2}}),(_treesByPageID$pageID=treesByPageID[pageID])===null||_treesByPageID$pageID===void 0?void 0:_treesByPageID$pageID.map(tree=>/*#__PURE__*/_jsx(\"div\",{className:\"block-pos-container\",style:{position:\"absolute\",width:\"fit-content\",top:`calc(max(20px, ${tree.location.y}px - var(--menu-bar-height)))`,left:`calc(max(40px, ${tree.location.x}px))`,zIndex:tree.zIndex},children:new Renderer(environment,typechecker,editor,{onEditValue}).render(rootIndexPath(tree))},tree.id))]}))},pageID);})})}),/*#__PURE__*/_jsxs(Nav,{activeKey:activePageID,onSelect:key=>key&&setActivePageID(Number(key)),variant:\"underline\",className:\"blocks-page-tabs mt-1 mx-4 mb-2\",children:[pageIDs.map(pageID=>{var _treesByPageID$pageID2,_treesByPageID$pageID3,_treesByPageID$pageID4,_treesByPageID$pageID5,_treesByPageID$pageID6,_pagesByID$pageID$nam,_pagesByID$pageID;const exprCount=(_treesByPageID$pageID2=(_treesByPageID$pageID3=treesByPageID[pageID])===null||_treesByPageID$pageID3===void 0?void 0:_treesByPageID$pageID3.length)!==null&&_treesByPageID$pageID2!==void 0?_treesByPageID$pageID2:0;const defineCount=(_treesByPageID$pageID4=(_treesByPageID$pageID5=treesByPageID[pageID])===null||_treesByPageID$pageID5===void 0?void 0:(_treesByPageID$pageID6=_treesByPageID$pageID5.filter(tree=>tree.root.kind===\"define\"))===null||_treesByPageID$pageID6===void 0?void 0:_treesByPageID$pageID6.length)!==null&&_treesByPageID$pageID4!==void 0?_treesByPageID$pageID4:0;return/*#__PURE__*/_jsx(Tippy,{content:/*#__PURE__*/_jsxs(\"small\",{className:\"d-flex flex-column mb-1\",style:{gap:\"0.5em\"},children:[/*#__PURE__*/_jsxs(\"div\",{children:[exprCount,\" \",exprCount===1?\"expression\":\"expressions\",\" (\",defineCount,\" \",defineCount===1?\"definition\":\"definitions\",\")\"]}),/*#__PURE__*/_jsx(\"div\",{children:\"Double-click to rename this page\"})]}),className:\"text-bg-dark\",arrow:false,offset:[0,0],placement:\"top-start\",zIndex:99999+2,children:/*#__PURE__*/_jsx(Nav.Item,{children:/*#__PURE__*/_jsx(Nav.Link,{eventKey:pageID,onDoubleClick:()=>{const newName=prompt(\"Enter page name:\");if(newName===null)return;const page=pagesByID[pageID];if(page)page.name=newName;else{meta.pages??=[];meta.pages.push({id:pageID,name:newName});}rerender();},children:(_pagesByID$pageID$nam=(_pagesByID$pageID=pagesByID[pageID])===null||_pagesByID$pageID===void 0?void 0:_pagesByID$pageID.name)!==null&&_pagesByID$pageID$nam!==void 0?_pagesByID$pageID$nam:`Page ${pageID}`})},pageID)});}),/*#__PURE__*/_jsx(Nav.Link,{className:\"px-2\",onClick:()=>{const name=prompt(\"Enter page name:\");if(name===null)return;meta.pages??=[];meta.pages.push({id:Math.max(...meta.pages.map(_ref7=>{let{id}=_ref7;return id;}))+1,name});rerender();},children:\"+\"})]})]})})]}),/*#__PURE__*/_jsx(Library,{})]})]});async function onEditValue(indexPath,applyAsFunction){const node=nodeAtIndexPath(indexPath);if(applyAsFunction){trees.replaceExpr(indexPath,{kind:\"call\",called:node,args:[]});}else{switch(node.kind){case\"name-binding\":editor.renameBinding(node,parentIndexPath(indexPath));break;case\"Boolean\":node.value=!node.value;break;case\"Number\":case\"String\":setValueEditorSubject(indexPath);break;default:setCodeEditorSubject(indexPath);break;}}}function onCodeEditorClose(newSource){// Close editor\nsetCodeEditorSubject(undefined);if(!newSource||!codeEditorSubject)return;const newExpr=Parser.parseToExpr(newSource);trees.replaceExpr(codeEditorSubject,newExpr);}function onValueEditorClose(newNode){// Close editor\nsetValueEditorSubject(undefined);if(!newNode||!valueEditorSubject)return;trees.replaceExpr(valueEditorSubject,newNode);}function indexPathFromDragged(item){var _item$data,_item$data$current;return item===null||item===void 0?void 0:(_item$data=item.data)===null||_item$data===void 0?void 0:(_item$data$current=_item$data.current)===null||_item$data$current===void 0?void 0:_item$data$current.indexPath;}function onBlockDragStart(_ref8){let{active}=_ref8;setTimeout(()=>{const activeIndexPath=indexPathFromDragged(active);if(!activeIndexPath)return;setActiveDrag({node:nodeAtIndexPath(activeIndexPath),indexPath:activeIndexPath,copyOnDrop:isAltPressed});});}function onBlockDragOver(_ref9){let{over}=_ref9;setActiveDragOver(over!==null&&over!==void 0?over:undefined);}function onBlockDragEnd(_ref10){var _active$data$current,_over$data$current;let{active,over,activatorEvent}=_ref10;setActiveDrag(undefined);setActiveDragOver(undefined);let activeIndexPath=indexPathFromDragged(active);if(!activeIndexPath)return;const shouldCopy=((_active$data$current=active.data.current)===null||_active$data$current===void 0?void 0:_active$data$current.copyOnDrop)||activatorEvent instanceof MouseEvent&&activatorEvent.altKey;if(over!==null&&over!==void 0&&(_over$data$current=over.data.current)!==null&&_over$data$current!==void 0&&_over$data$current.isLibrary){if(shouldCopy)return;trees.deleteExpr(activeIndexPath);rerender();return;}const dragBounds=active.rect.current.translated;// Adjust coordinates of drop point to account for context of scrolled container\nconst blocksAreaEl=blocksArea.current;const shiftY=blocksAreaEl.scrollTop-blocksAreaEl.getBoundingClientRect().top+48;const shiftX=blocksAreaEl.scrollLeft;dragBounds.top+=shiftY;dragBounds.bottom+=shiftY;dragBounds.left+=shiftX;dragBounds.right+=shiftX;const overIndexPath=indexPathFromDragged(over);if(/* Dropped on top of nothing */!overIndexPath||/* Dropped on root of a tree; just treat like movement */overIndexPath.path.length===0||/* Dropped on a descendant of itself; just treat like movement */isAncestor(activeIndexPath,overIndexPath)||(/* Non-type block dropped in type context */nodeAtIndexPath({tree:overIndexPath.tree,path:overIndexPath.path.slice(0,-1)}).kind===\"type\"&&nodeAtIndexPath(activeIndexPath).kind!==\"type\")){const orphanTree=trees.orphanExpr(activeIndexPath,{x:dragBounds.left,y:dragBounds.top},shouldCopy);activeIndexPath=rootIndexPath(orphanTree);}else{if(shouldCopy){trees.copyExprInTree(activeIndexPath,overIndexPath,{x:dragBounds.right,y:dragBounds.bottom});}else{trees.moveExprInTree(activeIndexPath,overIndexPath,{x:dragBounds.right,y:dragBounds.bottom});}}trees.bringToFront(activeIndexPath.tree);rerender();}}","map":{"version":3,"names":["useEffect","useRef","useState","Renderer","nodeAtIndexPath","isAncestor","rootIndexPath","parentIndexPath","DndContext","DragOverlay","useSensor","useSensors","Library","CodeEditorModal","Parser","ActiveDragContext","OnContextMenuContext","RenderCounterContext","RerenderContext","InitialEnvironment","mergeEnvs","CustomKeyboardSensor","CustomPointerSensor","Split","Typechecker","ValueEditorModal","OutputArea","Nav","Tab","groupBy","keyBy","Tippy","ContextMenuTrigger","Program","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","sortCollisionsClosestToZero","_ref","_ref2","data","value","a","b","Math","abs","midY","rect","top","bottom","collisionDetection","_ref3","collisionRect","droppableRects","droppableContainers","collisions","droppableContainer","id","get","max","height","right","left","intersectionStrength","push","sort","isAltPressed","EditorComponent","_ref4","_meta$pages","editor","onBlockContextMenu","codeEditorSubject","setCodeEditorSubject","renderCounter","trees","rerender","meta","typechecker","addDefines","list","valueEditorSubject","setValueEditorSubject","handleDocumentMouseDown","event","altKey","document","addEventListener","removeEventListener","weakRenderCounter","setWeakRenderCounter","weakRerender","activeDrag","setActiveDrag","activeDragOver","setActiveDragOver","blocksArea","provideEditorContext","body","Provider","children","activePageID","setActivePageID","currentPageID","pagesByID","pages","_ref5","treesByPageID","_ref6","page","pageIDs","Set","Object","keys","map","Number","values","candidate","undefined","includes","at","environment","defines","autoScroll","sensors","activationConstraint","distance","onDragStart","onBlockDragStart","onDragOver","onBlockDragOver","onDragEnd","onBlockDragEnd","indexPath","onClose","onCodeEditorClose","onValueEditorClose","dropAnimation","zIndex","className","forDragOverlay","render","direction","cursor","sizes","minSize","snapOffset","gutterSize","gutterAlign","Container","activeKey","Content","pageID","_treesByPageID$pageID","Pane","eventKey","ref","transition","unmountOnExit","style","width","tree","location","x","documentElement","clientWidth","y","clientHeight","position","onEditValue","onSelect","key","variant","_treesByPageID$pageID2","_treesByPageID$pageID3","_treesByPageID$pageID4","_treesByPageID$pageID5","_treesByPageID$pageID6","_pagesByID$pageID$nam","_pagesByID$pageID","exprCount","length","defineCount","filter","root","kind","content","gap","arrow","offset","placement","Item","Link","onDoubleClick","newName","prompt","name","onClick","_ref7","applyAsFunction","node","replaceExpr","called","args","renameBinding","newSource","newExpr","parseToExpr","newNode","indexPathFromDragged","item","_item$data","_item$data$current","current","_ref8","active","setTimeout","activeIndexPath","copyOnDrop","_ref9","over","_ref10","_active$data$current","_over$data$current","activatorEvent","shouldCopy","MouseEvent","isLibrary","deleteExpr","dragBounds","translated","blocksAreaEl","shiftY","scrollTop","getBoundingClientRect","shiftX","scrollLeft","overIndexPath","path","slice","orphanTree","orphanExpr","copyExprInTree","moveExprInTree","bringToFront"],"sources":["/Users/hamzashahzad/Desktop/resume_projects/sparkground/src/editor/Editor.tsx"],"sourcesContent":["import \"./editor.css\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { Renderer } from \"./trees/render\";\nimport {\n  TreeIndexPath,\n  nodeAtIndexPath,\n  isAncestor,\n  rootIndexPath,\n  parentIndexPath,\n} from \"./trees/tree\";\nimport {\n  Active,\n  ClientRect,\n  CollisionDescriptor,\n  CollisionDetection,\n  DndContext,\n  DragEndEvent,\n  DragOverEvent,\n  DragOverlay,\n  DragStartEvent,\n  Over,\n  useSensor,\n  useSensors,\n} from \"@dnd-kit/core\";\nimport Library from \"./library/Library\";\nimport { PageID } from \"./trees/trees\";\nimport CodeEditorModal from \"./CodeEditorModal\";\nimport { Expr, Var } from \"../expr/expr\";\nimport { Parser } from \"../expr/parse\";\nimport {\n  ActiveDragContext,\n  OnContextMenuContext,\n  RenderCounterContext,\n  RerenderContext,\n} from \"./editor-contexts\";\nimport { InitialEnvironment, mergeEnvs } from \"./library/environments\";\nimport { CustomKeyboardSensor, CustomPointerSensor } from \"./blocks/drag-sensors\";\nimport Split from \"react-split\";\nimport { Typechecker } from \"../typechecker/typecheck\";\nimport ValueEditorModal from \"./ValueEditorModal\";\nimport { OutputArea } from \"./OutputArea\";\nimport Nav from \"react-bootstrap/Nav\";\nimport Tab from \"react-bootstrap/Tab\";\nimport { groupBy, keyBy } from \"lodash\";\nimport Tippy from \"@tippyjs/react\";\nimport { ContextMenuTrigger } from \"rctx-contextmenu\";\nimport { Program } from \"../simulator/program\";\nimport { Editor } from \"./state/Editor\";\n\nexport type Props = {\n  editor: Editor;\n\n  onBlockContextMenu: (indexPath: TreeIndexPath) => void;\n\n  codeEditorSubject: TreeIndexPath | undefined;\n  setCodeEditorSubject: (indexPath?: TreeIndexPath) => void;\n\n  renderCounter: number;\n};\n\nfunction sortCollisionsClosestToZero(\n  { data: { value: a } }: CollisionDescriptor,\n  { data: { value: b } }: CollisionDescriptor,\n) {\n  return Math.abs(a) - Math.abs(b);\n}\n\nfunction midY(rect: ClientRect) {\n  return (rect.top + rect.bottom) / 2;\n}\n\nconst collisionDetection: CollisionDetection = ({\n  collisionRect,\n  droppableRects,\n  droppableContainers,\n}) => {\n  const collisions = [];\n\n  for (const droppableContainer of droppableContainers) {\n    const { id } = droppableContainer;\n    const rect = droppableRects.get(id);\n\n    if (\n      !(\n        rect &&\n        (id === \"library\" ||\n          Math.abs(midY(rect) - midY(collisionRect)) <=\n            Math.max(rect.height / 2, collisionRect.height / 2)) &&\n        rect.right >= collisionRect.left\n      )\n    ) {\n      continue;\n    }\n\n    const intersectionStrength = collisionRect.left - rect.left + (id === \"library\" ? 20 : 0);\n    if (intersectionStrength > 0) {\n      collisions.push({\n        id,\n        data: { droppableContainer, value: id === \"library\" ? 0 : intersectionStrength },\n      } satisfies CollisionDescriptor);\n    }\n  }\n\n  return collisions.sort(sortCollisionsClosestToZero);\n};\n\nexport type ActiveDrag = {\n  node: Expr;\n  indexPath: TreeIndexPath;\n  copyOnDrop?: boolean;\n};\n\nlet isAltPressed = false;\n\nexport default function EditorComponent({\n  editor,\n  onBlockContextMenu,\n  codeEditorSubject,\n  setCodeEditorSubject,\n  renderCounter,\n}: Props) {\n  const { trees, rerender } = editor;\n  const { meta } = trees;\n\n  const typechecker = new Typechecker();\n  typechecker.addDefines(trees.list());\n\n  const [valueEditorSubject, setValueEditorSubject] = useState<TreeIndexPath>();\n\n  useEffect(() => {\n    const handleDocumentMouseDown = (event: MouseEvent) => {\n      isAltPressed = event.altKey;\n    };\n\n    document.addEventListener(\"mousedown\", handleDocumentMouseDown);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleDocumentMouseDown);\n    };\n  }, []);\n\n  const [weakRenderCounter, setWeakRenderCounter] = useState(0);\n  function weakRerender() {\n    setWeakRenderCounter(weakRenderCounter + 1);\n  }\n\n  const [activeDrag, setActiveDrag] = useState<ActiveDrag>();\n  const [activeDragOver, setActiveDragOver] = useState<Over>();\n\n  const blocksArea = useRef<HTMLDivElement>(null);\n\n  function provideEditorContext(body: JSX.Element) {\n    return (\n      <OnContextMenuContext.Provider value={onBlockContextMenu}>\n        <ActiveDragContext.Provider value={activeDrag}>\n          <RerenderContext.Provider value={weakRerender}>\n            <RenderCounterContext.Provider value={renderCounter}>\n              {body}\n            </RenderCounterContext.Provider>\n          </RerenderContext.Provider>\n        </ActiveDragContext.Provider>\n      </OnContextMenuContext.Provider>\n    );\n  }\n\n  const [activePageID, setActivePageID] = useState<PageID>();\n\n  useEffect(() => {\n    meta.currentPageID = activePageID;\n  }, [activePageID]);\n\n  const pagesByID = keyBy(meta.pages ?? [], ({ id }) => id);\n  const treesByPageID = groupBy(trees.list(), ({ page }) => page);\n\n  const pageIDs = [\n    ...new Set([...Object.keys(pagesByID), ...Object.keys(treesByPageID)].map(Number)).values(),\n  ].sort();\n\n  useEffect(() => {\n    const candidate =\n      meta.currentPageID !== undefined && pageIDs.includes(meta.currentPageID)\n        ? meta.currentPageID\n        : pageIDs.at(-1);\n    if (candidate !== undefined || activePageID !== undefined) {\n      setActivePageID(candidate);\n    }\n  }, [meta]);\n\n  const environment = mergeEnvs<unknown>(\n    InitialEnvironment,\n    new Program(trees.list()).defines.environment(),\n  );\n\n  return (\n    <DndContext\n      autoScroll={false}\n      sensors={useSensors(\n        useSensor(CustomPointerSensor, { activationConstraint: { distance: 4 } }),\n        useSensor(CustomKeyboardSensor),\n      )}\n      collisionDetection={collisionDetection}\n      onDragStart={onBlockDragStart}\n      onDragOver={onBlockDragOver}\n      onDragEnd={onBlockDragEnd}\n    >\n      {provideEditorContext(\n        <>\n          <CodeEditorModal indexPath={codeEditorSubject} onClose={onCodeEditorClose} />\n          <ValueEditorModal indexPath={valueEditorSubject} onClose={onValueEditorClose} />\n\n          <DragOverlay dropAnimation={null} zIndex={99999999} className=\"drag-overlay\">\n            {activeDrag &&\n              new Renderer(environment, typechecker, editor, {\n                forDragOverlay: activeDragOver ?? true,\n              }).render(activeDrag.indexPath)}\n          </DragOverlay>\n        </>,\n      )}\n\n      <Split\n        className=\"editor-split split\"\n        direction=\"horizontal\"\n        cursor=\"col-resize\"\n        sizes={[78, 22]}\n        minSize={[0, 0]}\n        snapOffset={120}\n        gutterSize={12}\n        gutterAlign=\"center\"\n      >\n        <Split\n          className=\"canvas-split split\"\n          direction=\"vertical\"\n          cursor=\"row-resize\"\n          sizes={[40, 60]}\n          minSize={[0]}\n          snapOffset={120}\n          gutterSize={12}\n          gutterAlign=\"center\"\n        >\n          <OutputArea></OutputArea>\n\n          <div className=\"blocks\">\n            <Tab.Container activeKey={activePageID}>\n              <Tab.Content className=\"blocks-page-tabcontent\">\n                <ContextMenuTrigger id=\"editor-background-menu\">\n                  {pageIDs.map((pageID) => (\n                    <Tab.Pane\n                      key={pageID}\n                      eventKey={pageID}\n                      className=\"blocks-page\"\n                      ref={blocksArea}\n                      transition={false}\n                      unmountOnExit\n                    >\n                      {provideEditorContext(\n                        <>\n                          <div\n                            style={{\n                              width:\n                                Math.max(...trees.list().map((tree) => tree.location.x)) +\n                                document.documentElement.clientWidth / 2,\n                              height:\n                                Math.max(...trees.list().map((tree) => tree.location.y)) +\n                                document.documentElement.clientHeight / 2,\n                            }}\n                          />\n                          {treesByPageID[pageID]?.map((tree) => (\n                            <div\n                              key={tree.id}\n                              className=\"block-pos-container\"\n                              style={{\n                                position: \"absolute\",\n                                width: \"fit-content\",\n                                top: `calc(max(20px, ${tree.location.y}px - var(--menu-bar-height)))`,\n                                left: `calc(max(40px, ${tree.location.x}px))`,\n                                zIndex: tree.zIndex,\n                              }}\n                            >\n                              {new Renderer(environment, typechecker, editor, {\n                                onEditValue,\n                              }).render(rootIndexPath(tree))}\n                            </div>\n                          ))}\n                        </>,\n                      )}\n                    </Tab.Pane>\n                  ))}\n                </ContextMenuTrigger>\n              </Tab.Content>\n\n              <Nav\n                activeKey={activePageID}\n                onSelect={(key) => key && setActivePageID(Number(key))}\n                variant=\"underline\"\n                className=\"blocks-page-tabs mt-1 mx-4 mb-2\"\n              >\n                {pageIDs.map((pageID) => {\n                  const exprCount = treesByPageID[pageID]?.length ?? 0;\n                  const defineCount =\n                    treesByPageID[pageID]?.filter((tree) => tree.root.kind === \"define\")?.length ??\n                    0;\n\n                  return (\n                    <Tippy\n                      content={\n                        <small className=\"d-flex flex-column mb-1\" style={{ gap: \"0.5em\" }}>\n                          <div>\n                            {exprCount} {exprCount === 1 ? \"expression\" : \"expressions\"} (\n                            {defineCount} {defineCount === 1 ? \"definition\" : \"definitions\"})\n                          </div>\n                          <div>Double-click to rename this page</div>\n                        </small>\n                      }\n                      className=\"text-bg-dark\"\n                      arrow={false}\n                      offset={[0, 0]}\n                      placement=\"top-start\"\n                      zIndex={99999 + 2}\n                    >\n                      <Nav.Item key={pageID}>\n                        <Nav.Link\n                          eventKey={pageID}\n                          onDoubleClick={() => {\n                            const newName = prompt(\"Enter page name:\");\n                            if (newName === null) return;\n\n                            const page = pagesByID[pageID];\n                            if (page) page.name = newName;\n                            else {\n                              meta.pages ??= [];\n                              meta.pages.push({ id: pageID, name: newName });\n                            }\n\n                            rerender();\n                          }}\n                        >\n                          {pagesByID[pageID]?.name ?? `Page ${pageID}`}\n                        </Nav.Link>\n                      </Nav.Item>\n                    </Tippy>\n                  );\n                })}\n\n                <Nav.Link\n                  className=\"px-2\"\n                  onClick={() => {\n                    const name = prompt(\"Enter page name:\");\n                    if (name === null) return;\n\n                    meta.pages ??= [];\n                    meta.pages.push({\n                      id: Math.max(...meta.pages.map(({ id }) => id)) + 1,\n                      name,\n                    });\n\n                    rerender();\n                  }}\n                >\n                  +\n                </Nav.Link>\n              </Nav>\n            </Tab.Container>\n          </div>\n        </Split>\n\n        <Library />\n      </Split>\n    </DndContext>\n  );\n\n  async function onEditValue(indexPath: TreeIndexPath, applyAsFunction?: boolean) {\n    const node = nodeAtIndexPath(indexPath);\n\n    if (applyAsFunction) {\n      trees.replaceExpr(indexPath, { kind: \"call\", called: node, args: [] });\n    } else {\n      switch (node.kind) {\n        case \"name-binding\":\n          editor.renameBinding(node, parentIndexPath(indexPath));\n          break;\n        case \"Boolean\":\n          node.value = !node.value;\n          break;\n        case \"Number\":\n        case \"String\":\n          setValueEditorSubject(indexPath);\n          break;\n        default:\n          setCodeEditorSubject(indexPath);\n          break;\n      }\n    }\n  }\n\n  function onCodeEditorClose(newSource?: string) {\n    // Close editor\n    setCodeEditorSubject(undefined);\n\n    if (!newSource || !codeEditorSubject) return;\n\n    const newExpr = Parser.parseToExpr(newSource);\n    trees.replaceExpr(codeEditorSubject, newExpr);\n  }\n\n  function onValueEditorClose(newNode?: Expr) {\n    // Close editor\n    setValueEditorSubject(undefined);\n\n    if (!newNode || !valueEditorSubject) return;\n\n    trees.replaceExpr(valueEditorSubject, newNode);\n  }\n\n  function indexPathFromDragged(item: Active | Over | null): TreeIndexPath | undefined {\n    return item?.data?.current?.indexPath;\n  }\n\n  function onBlockDragStart({ active }: DragStartEvent) {\n    setTimeout(() => {\n      const activeIndexPath = indexPathFromDragged(active);\n      if (!activeIndexPath) return;\n\n      setActiveDrag({\n        node: nodeAtIndexPath(activeIndexPath),\n        indexPath: activeIndexPath,\n        copyOnDrop: isAltPressed,\n      });\n    });\n  }\n\n  function onBlockDragOver({ over }: DragOverEvent) {\n    setActiveDragOver(over ?? undefined);\n  }\n\n  function onBlockDragEnd({ active, over, activatorEvent }: DragEndEvent) {\n    setActiveDrag(undefined);\n    setActiveDragOver(undefined);\n\n    let activeIndexPath = indexPathFromDragged(active);\n    if (!activeIndexPath) return;\n\n    const shouldCopy =\n      active.data.current?.copyOnDrop ||\n      (activatorEvent instanceof MouseEvent && activatorEvent.altKey);\n\n    if (over?.data.current?.isLibrary) {\n      if (shouldCopy) return;\n\n      trees.deleteExpr(activeIndexPath);\n\n      rerender();\n      return;\n    }\n\n    const dragBounds = active!.rect.current.translated!;\n\n    // Adjust coordinates of drop point to account for context of scrolled container\n    const blocksAreaEl = blocksArea.current!;\n    const shiftY = blocksAreaEl.scrollTop - blocksAreaEl.getBoundingClientRect().top + 48;\n    const shiftX = blocksAreaEl.scrollLeft;\n    dragBounds.top += shiftY;\n    dragBounds.bottom += shiftY;\n    dragBounds.left += shiftX;\n    dragBounds.right += shiftX;\n\n    const overIndexPath = indexPathFromDragged(over);\n\n    if (\n      /* Dropped on top of nothing */\n      !overIndexPath ||\n      /* Dropped on root of a tree; just treat like movement */\n      overIndexPath.path.length === 0 ||\n      /* Dropped on a descendant of itself; just treat like movement */\n      isAncestor(activeIndexPath, overIndexPath) ||\n      /* Non-type block dropped in type context */\n      (nodeAtIndexPath({\n        tree: overIndexPath.tree,\n        path: overIndexPath.path.slice(0, -1),\n      }).kind === \"type\" &&\n        nodeAtIndexPath(activeIndexPath).kind !== \"type\")\n    ) {\n      const orphanTree = trees.orphanExpr(\n        activeIndexPath,\n        {\n          x: dragBounds.left,\n          y: dragBounds.top,\n        },\n        shouldCopy,\n      );\n      activeIndexPath = rootIndexPath(orphanTree);\n    } else {\n      if (shouldCopy) {\n        trees.copyExprInTree(activeIndexPath, overIndexPath, {\n          x: dragBounds.right,\n          y: dragBounds.bottom,\n        });\n      } else {\n        trees.moveExprInTree(activeIndexPath, overIndexPath, {\n          x: dragBounds.right,\n          y: dragBounds.bottom,\n        });\n      }\n    }\n\n    trees.bringToFront(activeIndexPath.tree);\n    rerender();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}